sudo: required
language: bash
services:
- docker
script:
- docker run --rm --privileged multiarch/qemu-user-static:register --reset
- docker build -t swestcott/rpi-prometheus:build .
- docker run swestcott/rpi-prometheus:build -version
- VERSION=$(docker inspect --format '{{ range .Config.Env }}{{ println . }}{{ end
  }}' swestcott/rpi-prometheus:build | grep PROMETHEUS_VERSION | sed 's/^.*=//')
- |
  if [ "$TRAVIS_BRANCH" == "master" ] && [ "$TRAVIS_PULL_REQUEST" == "false" ]; then
    docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    docker tag swestcott/rpi-prometheus:build swestcott/rpi-prometheus:$VERSION
    docker tag swestcott/rpi-prometheus:build swestcott/rpi-prometheus:latest
    docker push swestcott/rpi-prometheus:$VERSION
    docker push swestcott/rpi-prometheus:latest
  fi
notifications:
  slack:
    secure: xMzAiv3BQc6dWFLiK1Ngdki5K2Hnw6hjyf+xv67SeiRsnOdD3iwl2TzHDkiUCTFwIecDYM0mYAYaBUuH7MxXC6HtHNhBAxdttjOyu/47q4zRBa9ZLbyxV/JWPCZ/jCZGHP5fpORNtHd579hLcV1hwuZv68a4x1Bqn+/I2uF4WcAtc5fMeBHU2pzFvLyJomOHVjurgTS+IgNZdjQrdDvTjZDiHpxzzCI/sqAwDbCFmbU2KzsAp5yc9hFyasMM7xFFIA6fIL6DlPHWcfgRkuMf5NQqQYxrOihfxGs/KgTh33iFrh7X771/T4j9bKQSJYWTqsnOPIEXIcnu3kXrTiUOY9FXGuq+jwp/8HlUl70RIh/swGV18ECJjd/CX49UDvSbCVcLHRO2VTEU5u3dAdumtJ/jSSSABXUKplU8F3gv/SvxnIt4qfGG6coOsV24S5K+Q/O3zkTmZ45F5hofpREzkreQnnjV/dWQ5KKqnNIEZwYZWk4qzZT6xsrW4/uoUtumF+C8cjNqiXbTQjj8TyaTRBXP0fPxXdTG1yaOfaFwFfvXe6rsa4VCSB1TqNIbZZ0nqMs5dXTJr0uoWbOdfJvsrWFejxubr+6IiB+O6O4dK31tfqfC6j7BSJdKUntvScR+GMVnnmzHEYfJR3dYhJLi48s2GHvqF02mxem4/eVak0s=
